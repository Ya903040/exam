<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="js/pixi.min.js"></script>
    <script>
        let ap = 50;
        let app;
        let player;
        let keys = {};
        let keysDiv;
        let rect;
        let wall2;
        let wall;
        let arrRects = [];
        let arrRects2 = [];
        var street = 1200;

        window.onload = function () {
            app = new PIXI.Application(
                {
                    width: 2000,
                    height: 600,
                    backdroundColor: 0xFF00FF

                }
            );

            document.querySelector("#gameDiv").appendChild(app.view);

            app.stage.interactive = true;

            app.stage.on("pointerdown", pointerDown);
            app.stage.on("pointerup", pointerUp);

            player = new PIXI.Sprite.from("images/superhero.png");

            player.anchor.set(0.5);
            player.width = 50;
            player.height = 50;
            player.x = 700;
            player.y = app.view.height / 2;

            app.stage.addChild(player);
            let a = 20;

            app.stage.interactive = true;

            window.addEventListener("keydown", keysdown);
            window.addEventListener("keyup", keysup);
            app.ticker.add(gameLoop);

            keysDiv = document.querySelector("#keys");
            var v = 9;
            //let text = new PIXI.Text('This is a PixiJS text', { fontFamily: 'Arial', fontSize: 24, fill: 0xff1010, align: 'center' });
            //alert(v);
            for (let i = 0; i < ap; i++) {
                wall = new PIXI.Sprite.from("images/mansory.png");
                let min2 = 0;
                let max2 = 50;

                //let rand2 =  Math.floor(Math.random() * (max2 - min2 + 1)) + min2;

                let min = 50;
                let max = 200;
                let rand = Math.floor(Math.random() * (max - min + 1)) + min;

                wall.anchor.set(0.1);
                wall.x = app.view.width / 2 + i * 200 + rand;
                if (rand % 2 === 0) {
                    wall.y = app.view.height / 2 - rand / 2 + 200;
                    //v = app.view.width / 2 + i * 200 + rand;
                }
                else {
                    wall.y = app.view.height / 2 - rand - 200;

                }
                //v = app.view.width / 2 + i * 200 + rand;
                wall.width = 20;
                wall.height = 200 + rand / 8;

                v = wall.x;
                arrRects[i] = wall;

                if (keys["68"] && player.x >= street) {
                    street += 5;
                    wall.x -= 5;
                    console.log(street);
                }
                if (keys["65"] && player.x <= street - 100) {
                    street -= 5;
                    wall.x += 5;
                }
                app.stage.addChild(wall);
            }


        }
        function pointerDown(e) {
            player.width *= 1.05;
            player.height *= 1.05;

        }
        function pointerUp(e) {
            player.width /= 1.05;
            player.height /= 1.05;

        }



        function loopR(e) {
            for (let i = 0; i < ap; i++) {
                if (player.x + player.width <= arrRects[i].x && player.x >= arrRects[i].x + wall.width && player.y <= arrRects[i].y + wall.height || player.y + player.height >= arrRects[i].y + wall.height + 20) {
                    arrRects[i].x -= 10;
                }

            }

        }
        function loopL(e) {
            for (let i = 0; i < ap; i++) {
                if (player.x + 0 >= arrRects[i].x && player.x <= arrRects[i].x + 0 && player.y <= arrRects[i].y + 0 || player.y + player.height >= arrRects[i].y + 0 + 0) {
                    arrRects[i].x += 10;
                }

            }

        }



        function gameLoop() {
            //keysDiv.innerHTML = JSON.stringify(keys);
            if (player) {
                player.y += 5;
                if (player.y >= 585) {
                    player.y = 585;
                }
            }
            if (keys["32"] || keys["38"]) {
                player.y -= 30;
                if (player.y <= 15) {
                    player.y = 15;
                }
            }
            if (keys["87"]) {
                player.y -= 30;
            }
            if (keys["83"]) {
                player.y += 5;
            }
            if (keys["68"]) {
                loopR();

                if (wall.x <= player.x - 100) {
                    alert("Finish!!! You are winner!");
                    //renderer.backgroundColor = 0xFF00FF;
                    //let text = new PIXI.Text('This is a PixiJS text', { fontFamily: 'Arial', fontSize: 40, fill: 0xff1010, align: 'center' });
                }
            }

            if (keys["65"]) {
                loopL();
            }
        }
        function keysdown(e) {
            keys[e.keyCode] = true;
            console.log(keys);
        }
        function keysup(e) {
            keys[e.keyCode] = false;
        }


    </script>
</head>

<body>
    <div id="gameDiv">

    </div>

</body>

</html>